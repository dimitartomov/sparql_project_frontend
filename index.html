<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--meta name="description" content=""-->
    <!--meta name="author" content=""-->
    <!--link rel="icon" href="../../favicon.ico"-->

    <title>SPARQL Queries Front-End</title>

  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!--link href='//cdn.jsdelivr.net/npm/yasgui@2.7.29/dist/yasgui.min.css' rel='stylesheet' type='text/css'/-->
  <!--script src='//cdn.jsdelivr.net/npm/yasgui@2.7.29/dist/yasgui.min.js'></script-->

  <script type="text/javascript">
        function prepare_queries_html_forms() {

            //query5
            document.getElementById("q5_param1").innerHTML=document.getElementById("parameter").innerHTML;
            document.getElementById("q5_param2").innerHTML=document.getElementById("parameter").innerHTML;
            document.getElementById("q5_param3").innerHTML=document.getElementById("parameter").innerHTML;
            //parameter info query
            document.getElementById("param_info_param").innerHTML=document.getElementById("parameter").innerHTML;

        }
        window.onload = prepare_queries_html_forms;
  </script>
</head>

<body>
  <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse fixed-top">
        <a class="navbar-brand">Interface for queries</a>
      </nav>

      <div class="container">

        <div class="starter-template">
          <div class="alert alert-info">
            <strong>Info:</strong> Ensure the Jena-Fuseki server is running and the necessary .ttl files have been uploaded.
          </div>

          <!-- Parameter Info output-->
          <div class="panel panel-default">

            <div class="panel-body">
                <h3>Parameter Information</h3>
                <h5>This query returns the description of a parameter and the questions used to determine the value for that parameter.</h5>
                Choose parameter number: <select id="param_info_param"></select><br />
                <button type="button" class="btn btn-primary btn-xs" onclick="param_info_query()">Submit</button>
                <button type="button" class="btn btn-xs" onclick="clear_fields_param_info_query()">Clear</button>

            </div>
          </div>

          <div class="panel panel-default"><!-- output information -->
            <div class="panel-body">
              <h5><b>full information:</b></h5>
              <div id="outputbox_parameter_info">

                  <div class="panel-group">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          Parameter <!-- TODO implement dynamic title of the form "P<number> <name> (<label>)" -->
                        </h4>
                      </div>
                      <div class="panel">
                        <div class="panel-body" ><b>Name: </b> <span id="param_info_name">Parameter name</span></div>
                        <div class="panel-body" ><b>Label: </b> <span id="param_info_label">PAR</span></div>
                      </div>
                    </div>
                  </div>

                  <div class="panel-group">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          Description <a data-toggle="collapse" href="#param_info_description_panel"><span style="float: right;"><b>show/hide</b></span></a>
                        </h4>
                      </div>
                      <div id="param_info_description_panel" class="panel-collapse collapse">
                        <div class="panel-body" id="param_info_description">Parameter description</div>
                      </div>
                    </div>
                  </div>

                  <div class="panel-group">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          Implication <a data-toggle="collapse" href="#param_info_implication_panel"><span style="float: right;"><b>show/hide</b></span></a>
                        </h4>
                      </div>
                      <div id="param_info_implication_panel" class="panel-collapse collapse">
                        <div class="panel-body" id="param_info_implication">Parameter implication</div>
                      </div>
                    </div>
                  </div>

                  <div class="panel-group">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          Questions <a data-toggle="collapse" href="#param_info_questions_panel"><span style="float: right;"><b>show/hide</b></span></a>
                        </h4>
                      </div>
                      <div id="param_info_questions_panel" class="panel-collapse collapse">
                        <div class="panel-body" id="param_info_questions">
                          <div id="param_info_question_info">
                            <div id="param_info_question_name_and_label">QUESTION NAME</div>
                            <div id="param_info_question_question">QUESTION TEXT</div>
                            <div id="param_info_question_trigger_answer">ANSWER YES GIVES +</div>
                            <div id="param_info_question_examples">
                                            <div class="panel-group", style="display: inline-block">
                                              <div class="panel panel-default">
                                                <div class="panel-heading">
                                                  <div class="panel-title">English | YES</div>
                                                </div>
                                                <div class="panel-body">
                                                  EXAMPLE TEXT
                                                </div>
                                              </div>
                                            </div>
                                            <div class="panel-group", style="display: inline-block">
                                              <div class="panel panel-default">
                                                <div class="panel-heading">
                                                  <div class="panel-title">English | YES</div>
                                                </div>
                                                <div class="panel-body">
                                                  a.	Pez-o			<br />
                                                      play-1SG		<br />
                                                  ‘I play’			<br />
                                                   b.	Pez-is			<br />
                                                      play-2SG		<br />
                                                            ‘You play’			<br />
                                                            c.	Pez-i		<br />
                                                                play-3SG		<br />
                                                        ‘He/she plays’
                                                </div>
                                              </div>
                                            </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="panel-group">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          Manifestation clustering <a data-toggle="collapse" href="#param_info_manifestation_clustering_panel"><span style="float: right;"><b>show/hide</b></span></a>
                        </h4>
                      </div>
                      <div id="param_info_manifestation_clustering_panel" class="panel-collapse collapse">
                        <div class="panel-body" id="param_info_manifestation_clustering">Parameter manifestation clustering</div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          <!--/div--><!-- this should be useless but I wasn't sure if it closed an important and existing div -->

          <!-- Query 5 -->
          <div class="panel panel-default">

            <div class="panel-body">
                <h3>Query 5</h3>
                <h5>This query takes the values of two parameters and returns all languages that have these exact parameters with these exact values. In addition there could be selected a third parameter for its values of the forementioned languages to be queried.</h5>

                parameter 1: <select id="q5_param1"></select>
                value:
                <select id="q5_param1_value">
                  <option value="-1">  </option>
                  <option value="%2B"> + </option>
                  <option value="-"> - </option>
                  <option value="0"> 0 </option>
                </select>
                <br />
                parameter 2: <select id="q5_param2"></select>
                value:
                <select id="q5_param2_value">
                  <option value="-1">  </option>
                  <option value="%2B"> + </option>
                  <option value="-"> - </option>
                  <option value="0"> 0 </option>
                </select>
                <br />
                ([optional:] parameter 3: <select id="q5_param3"></select>)<br />
                <br />
                <br />
                <button type="button" class="btn btn-primary btn-xs" onclick="submit_query5()">Submit</button>
                <button type="button" class="btn btn-xs" onclick="clear_fields_query5()">Clear</button>
                <button type="button" class="btn btn-xs btn-link"><a id="query5_table_csv_download_link">tableLang_with_two_specified_parameters.CSV</a></button>
                <button type="button" class="btn btn-xs btn-link"><a id="query5_table_txt_download_link">tableLang_with_two_specified_parameters.TXT</a></button>

              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>languages:</b></h5>
                <div id="outputbox_query5">
                  Output is displayed here
                </div>
              </div>
            </div>

          <!-- Query 1 -->
          <div class="panel panel-default">
            <div class="panel-body">
                <h3>Query 1</h3>
                <h5>Selects all the <i>questions</i> for a single <i>parameter</i>.</h5>
                <span>Select a parameter: </span>
                <select id="parameter">
                  <!--TODO make this list authomated with a query (number of parameters may vary?, although very unlikely to do so)-->
                  <option value="0"> - </option>
                  <option value="FGP"> FGP </option>
                  <option value="FGM"> FGM </option>
                  <option value="FPC"> FPC </option>
                  <option value="FGT"> FGT </option>
                  <option value="FGN"> FGN </option>
                  <option value="GCO"> GCO </option>
                  <option value="PLS"> PLS </option>
                  <option value="FND"> FND </option>
                  <option value="FSN"> FSN </option>
                  <option value="FNN"> FNN </option>
                  <option value="SGE"> SGE </option>
                  <option value="FGG"> FGG </option>
                  <option value="CGB"> CGB </option>
                  <option value="DGR"> DGR </option>
                  <option value="DGP"> DGP </option>
                  <option value="CGR"> CGR </option>
                  <option value="NSD"> NSD </option>
                  <option value="FVP"> FVP </option>
                  <option value="DGD"> DGD </option>
                  <option value="DPQ"> DPQ </option>
                  <option value="DCN"> DCN </option>
                  <option value="DNN"> DNN </option>
                  <option value="DIN"> DIN </option>
                  <option value="FGC"> FGC </option>
                  <option value="DBC"> DBC </option>
                  <option value="XCN"> XCN </option>
                  <option value="GSC"> GSC </option>
                  <option value="NOE"> NOE </option>
                  <option value="HMP"> HMP </option>
                  <option value="AST"> AST </option>
                  <option value="FFS"> FFS </option>
                  <option value="ADI"> ADI </option>
                  <option value="DMP"> DMP </option>
                  <option value="DMG"> DMG </option>
                  <option value="GCN"> GCN </option>
                  <option value="GFN"> GFN </option>
                  <option value="GAL"> GAL </option>
                  <option value="GUN"> GUN </option>
                  <option value="EZ1"> EZ1 </option>
                  <option value="EZ2"> EZ2 </option>
                  <option value="EZ3"> EZ3 </option>
                  <option value="GAD"> GAD </option>
                  <option value="GFO"> GFO </option>
                  <option value="PGO"> PGO </option>
                  <option value="GFS"> GFS </option>
                  <option value="GIT"> GIT </option>
                  <option value="GSI"> GSI </option>
                  <option value="ALP"> ALP </option>
                  <option value="GST"> GST </option>
                  <option value="GEI"> GEI </option>
                  <option value="GNR"> GNR </option>
                  <option value="STC"> STC </option>
                  <option value="GPC"> GPC </option>
                  <option value="PMN"> PMN </option>
                  <option value="CQU"> CQU </option>
                  <option value="PCA"> PCA </option>
                  <option value="PSC"> PSC </option>
                  <option value="RHM"> RHM </option>
                  <option value="FRC"> FRC </option>
                  <option value="NRC"> NRC </option>
                  <option value="NOR"> NOR </option>
                  <option value="AER"> AER </option>
                  <option value="ARR"> ARR </option>
                  <option value="DOR"> DOR </option>
                  <option value="NOD"> NOD </option>
                  <option value="NOP"> NOP </option>
                  <option value="PNP"> PNP </option>
                  <option value="NPP"> NPP </option>
                  <option value="NGO"> NGO </option>
                  <option value="NOA"> NOA </option>
                  <option value="NM2"> NM2 </option>
                  <option value="NM1"> NM1 </option>
                  <option value="EAF"> EAF </option>
                  <option value="NON"> NON </option>
                  <option value="FPO"> FPO </option>
                  <option value="ACM"> ACM </option>
                  <option value="DOA"> DOA </option>
                  <option value="NEX"> NEX </option>
                  <option value="NCL"> NCL </option>
                  <option value="PDC"> PDC </option>
                  <option value="ACL"> ACL </option>
                  <option value="APO"> APO </option>
                  <option value="WAP"> WAP </option>
                  <option value="AGE"> AGE </option>
                  <option value="OPK"> OPK </option>
                  <option value="TSP"> TSP </option>
                  <option value="TSD"> TSD </option>
                  <option value="TAD"> TAD </option>
                  <option value="TDC"> TDC </option>
                  <option value="TLC"> TLC </option>
                  <option value="TNL"> TNL </option>
                </select>
                <br />
                <br />
                <button type="button" class="btn btn-primary btn-xs" onclick="submit_query1()">Submit</button>
                <button type="button" class="btn btn-xs" onclick="clear_fields_query1()">Clear</button>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>questions:</b></h5>
                  <div id="outputbox_query1">
                  Output is displayed here
                </div>
                <p id="errorbox_query1"></p>
                <p id="successbox_query1"></p>
              </div>
            </div>

            <!-- Query All Languages -->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 2</h3>
                  <h5>Returns all <i>languages</i>.</h5>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_all_languages()">Submit</button>
                  <button type="button" class="btn btn-xs" onclick="clear_all_languages()">Clear</button>
                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>languages:</b></h5>
                  <div id="outputbox_all_languages">
                  Output is displayed here
                </div>
              </div>
            </div>

            <!-- Query 3 - Table of parameter values-->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 3</h3>
                  <h5>Returns table of languages versus parameters. Each cell has the value of the <i>parameter</i> for that <i>language</i>.</h5>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_lang_param_values()">Retrieve</button>
                  <button type="button" class="btn btn-primary btn-xs" onclick="show_lang_param_values()">Show</button>
                  <button type="button" class="btn btn-xs" onclick="clear_lang_param_values()">Clear</button>
                  <br />
                  download table in TXT or CSV:
                  <button type="button" class="btn btn-xs btn-link"><a id="query3_table_txt_download_link">tableLangParams.TXT</a></button>
                  <button type="button" class="btn btn-xs btn-link"><a id="query3_table_csv_download_link">tableLangParams.CSV</a></button>
                  <br />table with 3 additional columns (number of pluses, minuses, and zeroes) for each lang:
                  <button type="button" class="btn btn-xs btn-link"><a id="query3_table1_txt_download_link">tableLangParams_with_sum_columns.TXT</a></button>
                  <button type="button" class="btn btn-xs btn-link"><a id="query3_table1_csv_download_link">tableLangParams_with_sum_columns.CSV</a></button>
                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>table:</b></h5>
                  <div style="overflow-x: scroll; overflow-y: hidden; white-space: nowrap;" id="outputbox_lang_param_values">
                  Output is displayed here
                </div>
              </div>
            </div>

            <!-- Query 4 - Table of parameter values-->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 4</h3>
                  <h5>Returns table of distances between languages Each cell is [(# of ++ pairs),(# of ++ or +- pairs)].</h5>
                  <b>Note: You may have to click "Retrieve" twice. Scroll down for a greyscale version of the table. Each cell's colour in RGB is ((1-x)*255,(1-x)*255,(1-x)*255) where x=[#(++)/#(+-)] .</b>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_lang_dist_values()">Retrieve</button>
                  <button type="button" class="btn btn-xs" onclick="clear_lang_dist_values()">Clear</button>
                  <button type="button" class="btn btn-xs btn-link"><a id="query4_table1_csv_download_link">tableLangLang_plusplus.CSV</a></button>
                  <button type="button" class="btn btn-xs btn-link"><a id="query4_table2_csv_download_link">tableLangLang_plusminus.CSV</a></button>

                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>table:</b></h5>
                  <div style="overflow-x: scroll; overflow-y: hidden; white-space: nowrap;" id="outputbox_lang_dist_values">
                  Output is displayed here
                </div>
              </div>
            </div>


        </div>
      </div>


  <script type="text/javascript">

    //render table data into html code inside table element with id 'table_id'
    function renderTable(outputbox_id,rowNames,colNames,table_data){//TODO: apply this function to all the tables throughout queries to simplify their code
      tablebox=document.getElementById(outputbox_id);
      html_code="";
      html_code+=`<table class="table table-striped table-sm table-responsive" style="display: inline-block;"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>`;
      for(i=0;i<colNames.length;i++) {
        html_code+=`<th scope="col">`+colNames[i]+`</th>`;
      }
      html_code+=`</tr></thead><tbody>`;
      for(i=0;i<table_data.length;i++) {
        html_code+=`<tr><th scope="row">`+rowNames[i]+`</th>`;
        for(j=0;j<table_data[i].length;j++){
          html_code+=`<td>`+table_data[i][j]+`</td>`;
        }
        html_code+=`</tr>`;
      }
      html_code+=`</tbody></table>`;
      html_code+=`<br />`;
      tablebox.innerHTML=html_code;
    }

    //create download link
    function create_download_button_link(MIME_TYPE,fileName,fileContent,button_link_id){
      // code adapted from [view-source:http://html5-demos.appspot.com/static/a.download.html]
      var bb = new Blob([fileContent], {type: MIME_TYPE});
      var a = document.getElementById(button_link_id);//the button link
      a.download = fileName;//filename of the downloaded file
      a.href = window.URL.createObjectURL(bb);
      a.dataset.downloadurl = [MIME_TYPE, a.download, a.href].join(':');
    }

    //stringify table to TXT or CSV
    function makeCSVfromTable(table,rowNames,colNames){
      table_csv="";
      table_csv+=" ";
      for(i=0;i<colNames.length;i++){
        table_csv+=','+colNames[i];
      }
      table_csv+='\n';
      for(i=0;i<table.length;i++){
          table_csv+=rowNames[i];
        for(j=0;j<table[i].length;j++){
          table_csv+=','+table[i][j];
        }
        table_csv+='\n';
      }
      return table_csv;
    }
    function makeTXTfromTable(table,rowNames,colNames){//WARNING: makeTXTfromTable() has problems with column width
      table_txt="";
      max_row_name_length=0;
      for(i=0;i<rowNames.length;i++){
        if(rowNames[i].length>max_row_name_length)max_row_name_length=rowNames[i].length;
      }
      for(i=0;i<max_row_name_length;i++){table_txt+=' ';}
      for(i=0;i<colNames.length;i++){
        table_txt+='\t|\t';
        table_txt+=colNames[i];
      }
      table_txt+='\t|\n';
      for(i=0;i<table.length;i++){
        for(k=0;k<max_row_name_length-rowNames[i].length;k++){table_txt+=' ';}
          table_txt+=rowNames[i];
        for(j=0;j<table[i].length;j++){
          table_txt+='\t|\t';
          table_txt+=' '+table[i][j]+' ';
        }
        table_txt+='\t|\n';
      }
      return table_txt;
    }


    //
    //QUERIES FOLLOW
    //

    //Query1

    function display_response_query1(response) {
        data=response['results']['bindings'];
        html_code="";
        //html_code+=response['head']['vars']; //gives the parameters (data fields), requested by the query
        for(i=0;i<data.length;i++) {
          html_code+="<b>"+i.toString()+"</b><p>"+data[i]['question']['value']+"</p></br>"+'\n';
        }
        document.getElementById("outputbox_query1").innerHTML=html_code;
    }
    function submit_query1() {
      server_url="http://localhost:3030/ds/query";
      parameter=document.getElementById("parameter").value;
      if(parameter==="0"){
        document.getElementById("outputbox_query1").innerHTML="<b>Please select a parameter!</b>";
      }
      else {
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fquestion%0AWHERE+%7B%0A++%3A"+parameter+"+%3AparamQuestion+%3Fq_id+.%0A++%3Fq_id+rdfs%3Adescription+%3Fquestion+.%0A%7D%0ALIMIT+250+%23just+some+large+number%0A";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";

      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            display_response_query1(response);
        },
        error : function(e) {
            //console.log("ERROR: ", e);
            document.getElementById("errorbox_query1").innerHTML = e;
        },
        done : function(e) {
            //console.log("DONE");
            document.getElementById("successbox_query1").innerHTML = "OK";
        }
        });
      }
    }

    function clear_fields_query1() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_query1").innerHTML = init_str;
    }

    //Show all languages TODO: replace this with renderTable()
    function process_all_languages(response) {
      data=response['results']['bindings'];
      html_code = "";
      html_code +=`<table class="table table-striped"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>
        <th scope="col">id</th>
        <th scope="col">Name</th>
      </tr></thead><tbody>`;
      for(i=0;i<data.length;i++) {
        lang_id=data[i]['lang']['value'];
        lang_id=lang_id.substring(26,lang_id.length);
        lang_name=data[i]['lang_name']['value'];
        html_code +=`<tr>
          <th scope="row">`+(i+1).toString()+`</th>
          <td >`+lang_id+`</td>
          <td >`+lang_name+`</td>
        </tr>`;
      }
      html_code+=`</tbody></table>`;
      document.getElementById("outputbox_all_languages").innerHTML = html_code;
    }
    function query_all_languages() {
      server_url="http://localhost:3030/ds/query";
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Flang+%3Flang_name%0AWHERE+%7B%0A++%3Flang+%3AlanguageAbbrev+%3Flang_abbrev+.%0A++%3Flang+rdfs%3Alabel+%3Flang_name+.%0A%7D%0A";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            process_all_languages(response);
        }
        });
    }
    function clear_all_languages() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_all_languages").innerHTML = init_str;
    }


    //Query 3 - Display table of languages and parameter values
    var param_data=[];
    var lang_data=[];
    //param_data.length=47;
    for(i=0;i<param_data.length;i++){
      param_data[i]={};
    }
    function check01(){
      //console.log(param_data);
    }
    function query_param_values(lang,index) {
      server_url="http://localhost:3030/ds/query";
      lang=lang.substring(26,lang.length);
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fparam+%3Fvalue%0AWHERE+%7B%0A++%3A"+lang+"+%3AlanguageParameters+%3Fparam_node+.%0A++%3Fparam_node+%3Fparam+%3Fvalue+.%0A%7D";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
          data=response['results']['bindings'];
          param_data[index]=data;
          //console.log(data);
          //console.log(param_data[index]);
        }
        });
    }
    function process_lang_param_values(languages,parameters,table) {
      html_code="";
      html_code+=`<table class="table table-striped" style="display: inline-block;"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>`;
      for(i=0;i<(table[0]).length;i++) {
        html_code+=`<th scope="col">`+parameters[i]+`</th>`;
      }
      html_code+=`</tr></thead><tbody>`;
      for(i=0;i<table.length;i++) {
        html_code+=`<tr><th scope="row">`+languages[i]+`</th>`;
        for(j=0;j<table[i].length;j++){
          html_code+=`<td>`+table[i][j]+`</td>`;
        }
        html_code+=`</tr>`;
      }
      html_code+=`</tbody></table>`;
      document.getElementById("outputbox_lang_param_values").innerHTML=html_code;
    }
    function query_lang_param_values() {
      server_url="http://localhost:3030/ds/query";
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Flang+%3Flang_name%0AWHERE+%7B%0A++%3Flang+%3AlanguageAbbrev+%3Flang_abbrev+.%0A++%3Flang+rdfs%3Alabel+%3Flang_name+.%0A%7D%0A";
      // query above returns all languages
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            data=response['results']['bindings'];
            languages=[]; //contains language names for corresponding row indeces in table[]
            for(i=0;i<data.length;i++) {
              lang=data[i]['lang']['value']; //this is the id of the language
              languages[i]=data[i]['lang_name']['value']; //full name of the language
              query_param_values(lang,i);
            }
            //console.log("response: ", response);
            //console.log("languages: ", languages);
            //console.log("parameters: ", parameters);
            //console.log("table: ", table);
            //check01();
            lang_data=languages;
        }
        });
    }
    function show_lang_param_values() {
      table=[]; // 2D array for later to be filled with $(data.length) rows for the languages and 91 columns for the parameters
      parameters=[]; //contains parameter names for corresponding column indeces in table[]
      table.length=lang_data.length;
      for(i=0;i<table.length;i++){
        table[i]=[]; //make a row for the parameters of the i-th language
        for(j=0;j<param_data[i].length;j++) {
          param_name=param_data[i][j]['param']['value'];
          param_name=param_name.substring(26,param_name.length);
          index=-1;
          if(i===0){parameters[j]=param_name;index=j}
          else {
            for(k=0;k<parameters.length;k++)if(parameters[k]===param_name){index=k;break;}
          }
          table[i][index]=param_data[i][j]['value']['value'];
        }
      }
      //console.log(table);
      //console.log(parameters);
      rowNames=lang_data;
      colNames=parameters;
      table_txt=makeTXTfromTable(table,rowNames,colNames);
      table_csv=makeCSVfromTable(table,rowNames,colNames);
      //add summation columns at the end of the table - 3 columns for the # of +,-,0 for each lang
      table1=[];
      for(i=0;i<table.length;i++){
        table1[i]=[];
        var j=0;
        var sum_plus=0;
        var sum_minus=0;
        var sum_zero=0;
        for(j=0;j<table[i].length;j++){
          table1[i][j]=table[i][j];
          if(table[i][j]==="+")sum_plus++;
          if(table[i][j]==="-")sum_minus++;
          if(table[i][j]==="0")sum_zero++;
        }
        table1[i][j++]=sum_plus;
        table1[i][j++]=sum_minus;
        table1[i][j++]=sum_zero;
      }
      colNames.push("N_+");
      colNames.push("N_-");
      colNames.push("N_0");
      table1_txt=makeTXTfromTable(table1,rowNames,colNames);
      table1_csv=makeCSVfromTable(table1,rowNames,colNames);
      //create download links
      const MIME_TYPE = 'text/plain';
      create_download_button_link(MIME_TYPE,"tableLangParams.txt",table_txt,"query3_table_txt_download_link");
      create_download_button_link(MIME_TYPE,"tableLangParams.csv",table_csv,"query3_table_csv_download_link");
      create_download_button_link(MIME_TYPE,"tableLangParams_with_sum_columns.txt",table1_txt,"query3_table1_txt_download_link");
      create_download_button_link(MIME_TYPE,"tableLangParams_with_sum_columns.csv",table1_csv,"query3_table1_csv_download_link");

      //display the data
      process_lang_param_values(lang_data,parameters,table);
      //TODO: (DONE) generalize the table display function as a function(table)->[html rendered code]
    }
    function clear_lang_param_values() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_lang_param_values").innerHTML=init_str;
    }

    //Query 4 - Display table of distances between languages
    //using the same data fron query 3 - the only difference is the show_data() function and the table_dist[][][] creation inside query_lang_dist_values()
    show_lang_dist_values();
    function query_lang_dist_values() {
      query_lang_param_values();
      table=[]; // 2D array for later to be filled with $(data.length) rows for the languages and 91 columns for the parameters
      parameters=[]; //contains parameter names for corresponding column indeces in table[]
      table.length=lang_data.length;
      for(i=0;i<table.length;i++){
        table[i]=[]; //make a row for the parameters of the i-th language
        for(j=0;j<param_data[i].length;j++) {
          param_name=param_data[i][j]['param']['value'];
          param_name=param_name.substring(26,param_name.length);
          index=-1;
          if(i===0){parameters[j]=param_name;index=j}
          else {
            for(k=0;k<parameters.length;k++)if(parameters[k]===param_name){index=k;break;}
          }
          table[i][index]=param_data[i][j]['value']['value'];
        }
      }

      table_dist=[];
      l=lang_data.length;
      for(i=0;i<l;i++){
        table_dist[i]=[];
        for(j=0;j<l;j++){
          num_plusplus=0;
          num_plusplus_or_plusminus=0;
          table_dist[i][j]=[];
          if(i===j){
            table_dist[i][j][0]=-1;
            table_dist[i][j][1]=-1;
          }
          for(k=0;k<l;k++){
            if(table[i][k]==="+"){
              if(table[j][k]==="+"){
                num_plusplus++; num_plusplus_or_plusminus++;
              }
              else if(table[j][k]==="-")num_plusplus_or_plusminus++;
            }
            else if(table[i][k]==="-"){
              if(table[j][k]==="+")num_plusplus_or_plusminus++;
            }
          }
          table_dist[i][j].push(num_plusplus);
          table_dist[i][j].push(num_plusplus_or_plusminus);

        }
      }
            table_pp=[];
            table_pm=[];

            for(i=0;i<table_dist.length;i++){
                  table_pp[i]=[];
                  table_pm[i]=[];

              for(j=0;j<table_dist.length;j++){
                table_pp[i][j]=table_dist[i][j][0];
                table_pm[i][j]=table_dist[i][j][1];

              }
            }
            rowNames=lang_data;
            colNames=lang_data;
            table_plusplus=makeCSVfromTable(table_pp,rowNames,colNames);
            table_plusminus=makeCSVfromTable(table_pm,rowNames,colNames);

            //create download links
            const MIME_TYPE = 'text/plain';
            create_download_button_link(MIME_TYPE,"tableLangLang_plusminus.csv",table_plusplus,"query4_table2_csv_download_link");
            create_download_button_link(MIME_TYPE,"tableLangLang_plusplus.csv",table_plusminus,"query4_table1_csv_download_link");

      show_lang_dist_values(table_dist);
    }
    function show_lang_dist_values(table_dist) {
      html_code="";
      html_code+=`<table class="table table-striped table-sm table-responsive" style="display: inline-block;"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>`;
      l=lang_data.length;
      for(i=0;i<l;i++) {
        html_code+=`<th scope="col">`+lang_data[i]+`</th>`;
      }
      html_code+=`</tr></thead><tbody>`;
      for(i=0;i<l;i++) {
        html_code+=`<tr><th scope="row">`+lang_data[i]+`</th>`;
        for(j=0;j<l;j++){
          if(table_dist[i][j][0]===-1){
            html_code+=`<td>(X,X)</td>`;
          }
          else  html_code+=`<td>(`+table_dist[i][j][0]+`,`+table_dist[i][j][1]+`)</td>`;
        }
        html_code+=`</tr>`;
      }
      html_code+=`</tbody></table>`;

      html_code+=`<br />`;
      html_code2=""
      html_code2+=`<table class="table table-striped table-sm table-responsive" style="display: inline-block;"><thead>`;
      html_code2 +=`<tr>
        <th scope="col">#</th>`;
      l=lang_data.length;
      for(i=0;i<l;i++) {
        html_code2+=`<th scope="col">`+lang_data[i]+`</th>`;
      }
      html_code2+=`</tr></thead><tbody>`;
      for(i=0;i<l;i++) {
        html_code2+=`<tr><th scope="row">`+lang_data[i]+`</th>`;
        for(j=0;j<l;j++){
          if(table_dist[i][j][0]===-1){
            html_code2+=`<td bgcolor="wheat"></td>`;
          }
          else {
            x=(table_dist[i][j][0])/(table_dist[i][j][1]);
            colour=x*255;
            html_code2+=`<td style="background-color:rgb(`+Math.floor(colour)+`,`+Math.floor(colour)+`,`+Math.floor(colour)+`);"></td>`;
          }
        }
        html_code2+=`</tr>`;
      }
      html_code2+=`</tbody></table>`;
      document.getElementById("outputbox_lang_dist_values").innerHTML=html_code+html_code2;
    }
    function clear_lang_dist_values() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_lang_dist_values").innerHTML=init_str;
    }


    //Query5

    function display_query5(response,param3){
      is_param3_specified=(param3==="NOTSPECIFIED"?0:1);
      languages=[];
      rowname=[];
      cols=[];
      cols.push("Languages");
      if(is_param3_specified===1)cols.push(param3);
      for(i=0;i<response.length;i++){
        languages[i]=[];
        rowname.push(i+1);
        languages[i].push(response[i]['lang_name']['value']);
        if(is_param3_specified===1){
          languages[i].push(response[i]['third_param_value']['value']);
        }
      }
      renderTable("outputbox_query5",rowname,cols,languages);

      //create download links
      table_q5_csv=makeCSVfromTable(languages,rowname,cols);
      table_q5_txt=makeTXTfromTable(languages,rowname,cols);
      const MIME_TYPE = 'text/plain';
      create_download_button_link(MIME_TYPE,"tableLang_with_two_specified_parameters.csv",table_q5_csv,"query5_table_csv_download_link");
      create_download_button_link(MIME_TYPE,"tableLang_with_two_specified_parameters.txt",table_q5_txt,"query5_table_txt_download_link");
    }
    function get_param(param_field_id){
      parameter=document.getElementById(param_field_id).value;
      if(parameter==="0"){
        return -1;
      }
      return parameter;
    }
    function get_param_value(param_value_field_id){
      param_value=document.getElementById(param_value_field_id).value;
      if(param_value==="-1"){
        return -1;
      }
      return param_value;
    }
    function submit_query5(){
      param1=get_param("q5_param1");
      param1_value=get_param_value("q5_param1_value");
      if(param1===-1||param1_value===-1)document.getElementById("outputbox_query5").innerHTML="<b>You have to select a value or name of parameter 1!</b>";
      param2=get_param("q5_param2");
      param2_value=get_param_value("q5_param2_value");
      if(param2===-1||param2_value===-1)document.getElementById("outputbox_query5").innerHTML="<b>You have to select a value or name of parameter 2!</b>";
      param3=get_param("q5_param3");
      if(param3===-1)param3="NOTSPECIFIED";

      server_url="http://localhost:3030/ds/query";
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Flang_name+%3Fthird_param_value%0AWHERE+%7B%0A++%3Flang_param_id+%3A"+param1+"+%22"+param1_value+"%22%3B%0A+++++++++++++++++%3A"+param2+"+%22"+param2_value+"%22.%0A++%3Flang_id+%3AlanguageParameters+%3Flang_param_id.%0A++%3Flang_id+rdfs%3Alabel+%3Flang_name.%0A++OPTIONAL%7B%3Flang_param_id+%3A"+param3+"+%3Fthird_param_value.%7D%0A%7D%0A";
      //console.log("param1_value:"+param1_value+"  param2_value:"+param2_value);
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";

      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            //console.log(response);
            data=response['results']['bindings'];
            display_query5(data,param3);
        }
        });
    }
    function clear_fields_query5() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_query5").innerHTML=init_str;
    }

    //Param info query

    function param_info_query(){
      paramNumber=1; // TODO: change this later to be dynamic
      get_param_info(paramNumber, "name_and_label");
      get_param_info(paramNumber, "description");
      get_param_info(paramNumber, "implication");
      get_param_info(paramNumber, "questions");
      get_param_info(paramNumber, "manifestationClustering");
    }
    function get_param_info(paramNumber, type){ //type is any of {name_and_label, description, questions, manifestationClustering}

      server_url="http://localhost:3030/ds/query";
      switch (type) {
        case "name_and_label":
          query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fname+%3Flabel%0AWHERE+%7B%0A++%3Flabel+%3Anumber+%22"+paramNumber.toString()+"%22.%0A++%3Flabel+rdfs%3Alabel+%3Fname.%0A%7D%0A";
          break;
        case "description":
          query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fparam_description%0AWHERE+%7B%0A++%3Fparam+%3Anumber+%22"+paramNumber.toString()+"%22.%0A++%3Fparam+rdfs%3Adescription+%3Fparam_description.%0A%7D%0A";
          break;
        case "implication":
          query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fimplication%0AWHERE+%7B%0A++%3Fparam+%3Anumber+%22"+paramNumber.toString()+"%22.%0A++%3Fparam+%3Aimplication+%3Fimplication.%0A%7D%0A";
          break;
        case "questions":
          query="";
          break;
        case "manifestationClustering":
          query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3FmanClust%0AWHERE+%7B%0A++%3Fparam+%3Anumber+%22"+paramNumber.toString()+"%22.%0A++%3Fparam+%3AmanifestationClustering+%3FmanClust.%0A%7D%0A";
          break;
      }
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";

      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            data=response['results']['bindings'];
            display_param_info(data, type);
        }
        });
    }
    function display_param_info(data, type){ //data is JSON and type is any of {name_and_label, description, questions, manifestationClustering}
      switch (type) {
        case 'name_and_label':
          param_name=data[0]['name']['value'];
          param_label=data[0]['label']['value'];
          document.getElementById('param_info_name').innerHTML=param_name;
          document.getElementById('param_info_label').innerHTML=param_label.substring(param_label.length-3,param_label.length);
          break;
        case 'description':
          param_description=data[0]['param_description']['value'];
          document.getElementById('param_info_description').innerHTML=param_description;
          break;
        case 'implication':
          param_implication=data[0]['implication']['value'];
          document.getElementById('param_info_implication').innerHTML=param_implication;
          break;
        case 'questions':
          ;
          break;
        case 'manifestationClustering':
          param_manClust=data[0]['manClust']['value'];
          document.getElementById('param_info_manifestation_clustering').innerHTML=param_manClust;
          // TODO: treat somehow manClust as a string of multiple lines and render is probably with element.append(sth that is verbose) // // QUESTION: check if this is shorter than recording multiple triplets in the DB
          break;
      }
    }
    function clear_fields_param_info_query() {
      document.getElementById("param_info_name").innerHTML="Parameter name";
      document.getElementById("param_info_label").innerHTML="PAR";
    }
  </script>
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
</body>
<footer class="page-footer font-small blue">

  <div class=" text-center py-3">Git Repo:
    <a href="https://github.com/dimitartomov/sparql_project_frontend"> https://github.com/dimitartomov/sparql_project_frontend</a>
    <br />
    <br />
  </div>

</footer>
</html>


<!--curl http://localhost:3030/ds/query -X POST --data 'query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fquestion%0AWHERE+%7B%0A++%3AFGP+%3AparamQuestion+%3Fq_id+.%0A++%3Fq_id+rdfs%3Adescription+%3Fquestion+.%0A%7D%0ALIMIT+250+%23just+some+large+number%0A' -H 'Accept: application/sparql-results+json' -->
