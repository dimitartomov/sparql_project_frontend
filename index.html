<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--meta name="description" content=""-->
    <!--meta name="author" content=""-->
    <!--link rel="icon" href="../../favicon.ico"-->

    <title>SPARQL Queries Front-End</title>

  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!--link href='//cdn.jsdelivr.net/npm/yasgui@2.7.29/dist/yasgui.min.css' rel='stylesheet' type='text/css'/-->
  <!--script src='//cdn.jsdelivr.net/npm/yasgui@2.7.29/dist/yasgui.min.js'></script-->
</head>

<body>
  <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse fixed-top">
        <a class="navbar-brand">Interface for queries</a>
      </nav>

      <div class="container">

        <div class="starter-template">
          <div class="alert alert-info">
            <strong>Info:</strong> Ensure the Jena-Fuseki server is running and the necessary .ttl files have been uploaded.
          </div>
          <!-- Query 1 -->
          <div class="panel panel-default">
            <div class="panel-body">
                <h3>Query 1</h3>
                <h5>Selects all the <i>questions</i> for a single <i>parameter</i>.</h5>
                <span>Select a parameter: </span>
                <select id="parameter">
                  <option value="FGP"> FGP </option>
                  <option value="FGM"> FGM </option>
                  <option value="FPC"> FPC </option>
                  <option value="FGT"> FGT </option>
                  <option value="FGN"> FGN </option>
                  <option value="GCO"> GCO </option>
                  <option value="PLS"> PLS </option>
                  <option value="FND"> FND </option>
                  <option value="FSN"> FSN </option>
                  <option value="FNN"> FNN </option>
                  <option value="SGE"> SGE </option>
                  <option value="FGG"> FGG </option>
                  <option value="CGB"> CGB </option>
                  <option value="DGR"> DGR </option>
                  <option value="DGP"> DGP </option>
                  <option value="CGR"> CGR </option>
                  <option value="NSD"> NSD </option>
                  <option value="FVP"> FVP </option>
                  <option value="DGD"> DGD </option>
                  <option value="DPQ"> DPQ </option>
                  <option value="DCN"> DCN </option>
                  <option value="DNN"> DNN </option>
                  <option value="DIN"> DIN </option>
                  <option value="FGC"> FGC </option>
                  <option value="DBC"> DBC </option>
                  <option value="XCN"> XCN </option>
                  <option value="GSC"> GSC </option>
                  <option value="NOE"> NOE </option>
                  <option value="HMP"> HMP </option>
                  <option value="AST"> AST </option>
                  <option value="FFS"> FFS </option>
                  <option value="ADI"> ADI </option>
                  <option value="DMP"> DMP </option>
                  <option value="DMG"> DMG </option>
                  <option value="GCN"> GCN </option>
                  <option value="GFN"> GFN </option>
                  <option value="GAL"> GAL </option>
                  <option value="GUN"> GUN </option>
                  <option value="EZ1"> EZ1 </option>
                  <option value="EZ2"> EZ2 </option>
                  <option value="EZ3"> EZ3 </option>
                  <option value="GAD"> GAD </option>
                  <option value="GFO"> GFO </option>
                  <option value="PGO"> PGO </option>
                  <option value="GFS"> GFS </option>
                  <option value="GIT"> GIT </option>
                  <option value="GSI"> GSI </option>
                  <option value="ALP"> ALP </option>
                  <option value="GST"> GST </option>
                  <option value="GEI"> GEI </option>
                  <option value="GNR"> GNR </option>
                  <option value="STC"> STC </option>
                  <option value="GPC"> GPC </option>
                  <option value="PMN"> PMN </option>
                  <option value="CQU"> CQU </option>
                  <option value="PCA"> PCA </option>
                  <option value="PSC"> PSC </option>
                  <option value="RHM"> RHM </option>
                  <option value="FRC"> FRC </option>
                  <option value="NRC"> NRC </option>
                  <option value="NOR"> NOR </option>
                  <option value="AER"> AER </option>
                  <option value="ARR"> ARR </option>
                  <option value="DOR"> DOR </option>
                  <option value="NOD"> NOD </option>
                  <option value="NOP"> NOP </option>
                  <option value="PNP"> PNP </option>
                  <option value="NPP"> NPP </option>
                  <option value="NGO"> NGO </option>
                  <option value="NOA"> NOA </option>
                  <option value="NM2"> NM2 </option>
                  <option value="NM1"> NM1 </option>
                  <option value="EAF"> EAF </option>
                  <option value="NON"> NON </option>
                  <option value="FPO"> FPO </option>
                  <option value="ACM"> ACM </option>
                  <option value="DOA"> DOA </option>
                  <option value="NEX"> NEX </option>
                  <option value="NCL"> NCL </option>
                  <option value="PDC"> PDC </option>
                  <option value="ACL"> ACL </option>
                  <option value="APO"> APO </option>
                  <option value="WAP"> WAP </option>
                  <option value="AGE"> AGE </option>
                  <option value="OPK"> OPK </option>
                  <option value="TSP"> TSP </option>
                  <option value="TSD"> TSD </option>
                  <option value="TAD"> TAD </option>
                  <option value="TDC"> TDC </option>
                  <option value="TLC"> TLC </option>
                  <option value="TNL"> TNL </option>
                </select>
                <br />
                <br />
                <button type="button" class="btn btn-primary btn-xs" onclick="submit_query1()">Submit</button>
                <button type="button" class="btn btn-xs" onclick="clear_fields_query1()">Clear</button>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>questions:</b></h5>
                  <div id="outputbox_query1">
                  Output is displayed here
                </div>
                <p id="errorbox_query1"></p>
                <p id="successbox_query1"></p>
              </div>
            </div>

            <!-- Query All Languages -->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 2</h3>
                  <h5>Returns all <i>languages</i>.</h5>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_all_languages()">Submit</button>
                  <button type="button" class="btn btn-xs" onclick="clear_all_languages()">Clear</button>
                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>languages:</b></h5>
                  <div id="outputbox_all_languages">
                  Output is displayed here
                </div>
              </div>
            </div>

            <!-- Query 3 - Table of parameter values-->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 3</h3>
                  <h5>Returns table of languages versus parameters. Each cell has the value of the <i>parameter</i> for that <i>language</i>.</h5>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_lang_param_values()">Retrieve</button>
                  <button type="button" class="btn btn-primary btn-xs" onclick="show_lang_param_values()">Show</button>
                  <button type="button" class="btn btn-xs" onclick="clear_lang_param_values()">Clear</button>
                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>table:</b></h5>
                  <div style="overflow-x: scroll; overflow-y: hidden; white-space: nowrap;" id="outputbox_lang_param_values">
                  Output is displayed here
                </div>
              </div>
            </div>

            <!-- Query 4 - Table of parameter values-->

            <div class="panel panel-default">
              <div class="panel-body">
                  <h3>Query 4</h3>
                  <h5>Returns table of distances between languages Each cell is [(# of ++ pairs),(# of ++ or +- pairs)].</h5>
                  <b>Note: You may have to click "Retrieve" twice. Scroll down for a greyscale version of the table. Each cell's colour in RGB is ((1-x)*255,(1-x)*255,(1-x)*255) where x=[avg(#(+-),#(++))]/#(+-) .</b>
                  <br />
                  <button type="button" class="btn btn-primary btn-xs" onclick="query_lang_dist_values()">Retrieve</button>
                  <button type="button" class="btn btn-xs" onclick="clear_lang_dist_values()">Clear</button>
                </div>
              </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <h5><b>table:</b></h5>
                  <div style="overflow-x: scroll; overflow-y: hidden; white-space: nowrap;" id="outputbox_lang_dist_values">
                  Output is displayed here
                </div>
              </div>
            </div>


        </div>
      </div>


  <script type="text/javascript">
    //clear function for all queries

    //Query1

    function display_response_query1(response) {
        data=response['results']['bindings'];
        html_code="";
        //html_code+=response['head']['vars']; //gives the parameters (data fields), requested by the query
        for(i=0;i<data.length;i++) {
          html_code+="<b>"+i.toString()+"</b><p>"+data[i]['question']['value']+"</p></br>"+'\n';
        }
        document.getElementById("outputbox_query1").innerHTML=html_code;
    }
    function submit_query1() {
      server_url="http://localhost:3030/ds/query";
      parameter=document.getElementById("parameter").value;
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fquestion%0AWHERE+%7B%0A++%3A"+parameter+"+%3AparamQuestion+%3Fq_id+.%0A++%3Fq_id+rdfs%3Adescription+%3Fquestion+.%0A%7D%0ALIMIT+250+%23just+some+large+number%0A";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      /*
      var request= new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("outputbox").innerHTML = this.responseText;
        }
      };
      request.open(POST,server_url,true);
      request.setRequestHeader("Accept", "application/sparql-results+json");
      request.send(query);
      */

      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            display_response_query1(response);
        },
        error : function(e) {
            //console.log("ERROR: ", e);
            document.getElementById("errorbox_query1").innerHTML = e;
        },
        done : function(e) {
            //console.log("DONE");
            document.getElementById("successbox_query1").innerHTML = "OK";
        }
        });

    }

    function clear_fields_query1() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_query1").innerHTML = init_str;
    }

    //Show all languages
    function process_all_languages(response) {
      data=response['results']['bindings'];
      html_code = "";
      html_code +=`<table class="table table-striped"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>
        <th scope="col">id</th>
        <th scope="col">Name</th>
      </tr></thead><tbody>`;
      for(i=0;i<data.length;i++) {
        lang_id=data[i]['lang']['value'];
        lang_id=lang_id.substring(26,lang_id.length);
        lang_name=data[i]['lang_name']['value'];
        html_code +=`<tr>
          <th scope="row">`+(i+1).toString()+`</th>
          <td >`+lang_id+`</td>
          <td >`+lang_name+`</td>
        </tr>`;
      }
      html_code+=`</tbody></table>`;
      document.getElementById("outputbox_all_languages").innerHTML = html_code;
    }
    function query_all_languages() {
      server_url="http://localhost:3030/ds/query";
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Flang+%3Flang_name%0AWHERE+%7B%0A++%3Flang+%3AlanguageAbbrev+%3Flang_abbrev+.%0A++%3Flang+rdfs%3Alabel+%3Flang_name+.%0A%7D%0A";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            process_all_languages(response);
        }
        });
    }
    function clear_all_languages() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_all_languages").innerHTML = init_str;
    }

    //Query 3 - Display table of languages and parameter values
    var param_data=[];
    var lang_data=[];
    //param_data.length=47;
    for(i=0;i<param_data.length;i++){
      param_data[i]={};
    }
    function check01(){
      console.log(param_data);
    }
    function query_param_values(lang,index) {
      server_url="http://localhost:3030/ds/query";
      lang=lang.substring(26,lang.length);
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fparam+%3Fvalue%0AWHERE+%7B%0A++%3A"+lang+"+%3AlanguageParameters+%3Fparam_node+.%0A++%3Fparam_node+%3Fparam+%3Fvalue+.%0A%7D";
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
          data=response['results']['bindings'];
          param_data[index]=data;
          //console.log(data);
          //console.log(param_data[index]);
        }
        });
    }
    function process_lang_param_values(languages,parameters,table) {
      html_code="";
      html_code+=`<table class="table table-striped" style="display: inline-block;"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>`;
      for(i=0;i<(table[0]).length;i++) {
        html_code+=`<th scope="col">`+parameters[i]+`</th>`;
      }
      html_code+=`</tr></thead><tbody>`;
      for(i=0;i<table.length;i++) {
        html_code+=`<tr><th scope="row">`+languages[i]+`</th>`;
        for(j=0;j<table[i].length;j++){
          html_code+=`<td>`+table[i][j]+`</td>`;
        }
        html_code+=`</tr>`;
      }
      html_code+=`</tbody></table>`;
      document.getElementById("outputbox_lang_param_values").innerHTML=html_code;
    }
    function query_lang_param_values() {
      server_url="http://localhost:3030/ds/query";
      query="query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Flang+%3Flang_name%0AWHERE+%7B%0A++%3Flang+%3AlanguageAbbrev+%3Flang_abbrev+.%0A++%3Flang+rdfs%3Alabel+%3Flang_name+.%0A%7D%0A";
      // query above returns all languages
      header="Accept: application/sparql-results+json";
      TypeOfResponseData="JSON";
      $.ajax({
        type : "POST",
        Accept : "application/sparql-results+"+TypeOfResponseData,
        url : server_url,
        data : query,
        dataType : TypeOfResponseData,
        success : function(response) {
            //console.log("SUCCESS: ", response);
            data=response['results']['bindings'];
            languages=[]; //contains language names for corresponding row indeces in table[]
            for(i=0;i<data.length;i++) {
              lang=data[i]['lang']['value']; //this is the id of the language
              languages[i]=data[i]['lang_name']['value']; //full name of the language
              query_param_values(lang,i);
            }
            //console.log("response: ", response);
            //console.log("languages: ", languages);
            //console.log("parameters: ", parameters);
            //console.log("table: ", table);
            //check01();
            lang_data=languages;
        }
        });
    }
    function show_lang_param_values() {
      table=[]; // 2D array for later to be filled with $(data.length) rows for the languages and 91 columns for the parameters
      parameters=[]; //contains parameter names for corresponding column indeces in table[]
      table.length=lang_data.length;
      for(i=0;i<table.length;i++){
        table[i]=[]; //make a row for the parameters of the i-th language
        for(j=0;j<param_data[i].length;j++) {
          param_name=param_data[i][j]['param']['value'];
          param_name=param_name.substring(26,param_name.length);
          index=-1;
          if(i===0){parameters[j]=param_name;index=j}
          else {
            for(k=0;k<parameters.length;k++)if(parameters[k]===param_name){index=k;break;}
          }
          table[i][index]=param_data[i][j]['value']['value'];
        }
      }
      //console.log(table);
      //console.log(parameters);
      process_lang_param_values(lang_data,parameters,table);
    }
    function clear_lang_param_values() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_lang_param_values").innerHTML=init_str;
    }

    //Query 4 - Display table of distances between languages
    //using the same data fron query 3 - the only difference is the show_data() function and the table_dist[][][] creation inside query_lang_dist_values()
    show_lang_dist_values();
    function query_lang_dist_values() {
      query_lang_param_values();
      table=[]; // 2D array for later to be filled with $(data.length) rows for the languages and 91 columns for the parameters
      parameters=[]; //contains parameter names for corresponding column indeces in table[]
      table.length=lang_data.length;
      for(i=0;i<table.length;i++){
        table[i]=[]; //make a row for the parameters of the i-th language
        for(j=0;j<param_data[i].length;j++) {
          param_name=param_data[i][j]['param']['value'];
          param_name=param_name.substring(26,param_name.length);
          index=-1;
          if(i===0){parameters[j]=param_name;index=j}
          else {
            for(k=0;k<parameters.length;k++)if(parameters[k]===param_name){index=k;break;}
          }
          table[i][index]=param_data[i][j]['value']['value'];
        }
      }

      table_dist=[];
      l=lang_data.length;
      for(i=0;i<l;i++){
        table_dist[i]=[];
        for(j=0;j<l;j++){
          num_plusplus=0;
          num_plusplus_or_plusminus=0;
          table_dist[i][j]=[];
          if(i===j){
            table_dist[i][j][0]=-1;
            table_dist[i][j][1]=-1;
          }
          for(k=0;k<l;k++){
            if(table[i][k]==="+"){
              if(table[j][k]==="+"){
                num_plusplus++; num_plusplus_or_plusminus++;
              }
              else if(table[j][k]==="-")num_plusplus_or_plusminus++;
            }
            else if(table[i][k]==="-"){
              if(table[j][k]==="+")num_plusplus_or_plusminus++;
            }
          }
          table_dist[i][j].push(num_plusplus);
          table_dist[i][j].push(num_plusplus_or_plusminus);
        }
      }
      show_lang_dist_values(table_dist);
    }
    function show_lang_dist_values(table_dist) {
      html_code="";
      html_code+=`<table class="table table-striped table-sm table-responsive" style="display: inline-block;"><thead>`;
      html_code +=`<tr>
        <th scope="col">#</th>`;
      l=lang_data.length;
      for(i=0;i<l;i++) {
        html_code+=`<th scope="col">`+lang_data[i]+`</th>`;
      }
      html_code+=`</tr></thead><tbody>`;
      for(i=0;i<l;i++) {
        html_code+=`<tr><th scope="row">`+lang_data[i]+`</th>`;
        for(j=0;j<l;j++){
          if(table_dist[i][j][0]===-1){
            html_code+=`<td>(X,X)</td>`;
          }
          else  html_code+=`<td>(`+table_dist[i][j][0]+`,`+table_dist[i][j][1]+`)</td>`;
        }
        html_code+=`</tr>`;
      }
      html_code+=`</tbody></table>`;

      html_code+=`<br />`;
      html_code2=""
      html_code2+=`<table class="table table-striped table-sm table-responsive" style="display: inline-block;"><thead>`;
      html_code2 +=`<tr>
        <th scope="col">#</th>`;
      l=lang_data.length;
      for(i=0;i<l;i++) {
        html_code2+=`<th scope="col">`+lang_data[i]+`</th>`;
      }
      html_code2+=`</tr></thead><tbody>`;
      for(i=0;i<l;i++) {
        html_code2+=`<tr><th scope="row">`+lang_data[i]+`</th>`;
        for(j=0;j<l;j++){
          if(table_dist[i][j][0]===-1){
            html_code2+=`<td bgcolor="wheat"></td>`;
          }
          else {
            x=((table_dist[i][j][1]-table_dist[i][j][0])/2)/(table_dist[i][j][1]);
            colour=(1-x)*255;
            html_code2+=`<td style="background-color:rgb(`+Math.floor(colour)+`,`+Math.floor(colour)+`,`+Math.floor(colour)+`);"></td>`;
          }
        }
        html_code2+=`</tr>`;
      }
      html_code2+=`</tbody></table>`;
      document.getElementById("outputbox_lang_dist_values").innerHTML=html_code+html_code2;
    }
    function clear_lang_dist_values() {
      init_str="Output is displayed here";
      document.getElementById("outputbox_lang_dist_values").innerHTML=init_str;
    }
  </script>
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
</body>
<footer class="page-footer font-small blue">

  <div class=" text-center py-3">Git Repo:
    <a href="https://github.com/dimitartomov/sparql_project_frontend"> https://github.com/dimitartomov/sparql_project_frontend</a>
    <br />
    <br />
  </div>

</footer>
</html>


<!--curl http://localhost:3030/ds/query -X POST --data 'query=prefix+%3A+%3Chttp%3A%2F%2Flangelin.org%2Fns%2Fv1%23%3E%0Aprefix+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0Aprefix+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0A%0ASELECT+%3Fquestion%0AWHERE+%7B%0A++%3AFGP+%3AparamQuestion+%3Fq_id+.%0A++%3Fq_id+rdfs%3Adescription+%3Fquestion+.%0A%7D%0ALIMIT+250+%23just+some+large+number%0A' -H 'Accept: application/sparql-results+json' -->
